<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BenMark - Resumen de Tesorer√≠a</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase.js"></script>
    <script src="../js/notifications.js"></script>
    <script src="../js/page-protection.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <img src="../images/logo-benmarket.jpg" alt="BenMarket" class="navbar-logo">
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Ingresos</a></li>
                <li><a href="egresosCaja.html" class="nav-link">Egresos</a></li>
                <li><a href="operaciones.html" class="nav-link">Operaciones</a></li>
                <li><a href="arqueo.html" class="nav-link">Arqueo de Caja</a></li>
                <li><a href="resumenServicios.html" class="nav-link">Resumen Servicios</a></li>
                <li><a href="resumen.html" class="nav-link activo">Resumen Tesoreria</a></li>
                <li id="nav-usuarios"><a href="usuarios.html" class="nav-link">Usuarios</a></li>
            </ul>
            <div class="nav-usuario">
                <span id="nombreUsuarioNav"></span>
                <a href="#" onclick="event.preventDefault(); cerrarSesion()" class="nav-link-logout">Cerrar Sesi√≥n</a>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Secci√≥n de Resumen -->
        <section id="resumen" class="seccion activa">


            <!-- **NUEVO:** Dashboard de M√©tricas -->
            <div class="resumen-filtros">
                <div class="form-grupo">
                    <label for="fechaResumenDesde">Desde:</label>
                    <input type="date" id="fechaResumenDesde" onchange="cargarResumenDiario()">
                </div>
                <div class="form-grupo">
                    <label for="fechaResumenHasta">Hasta:</label>
                    <input type="date" id="fechaResumenHasta" onchange="cargarResumenDiario()">
                </div>
                <div class="form-grupo">
                    <label for="filtroCajaGeneral">Caja:</label>
                    <select id="filtroCajaGeneral" onchange="aplicarFiltroCajaGeneral()">
                        <option value="">Todas las Cajas</option>
                        <option value="Caja 1">Caja 1</option>
                        <option value="Caja 2">Caja 2</option>
                        <option value="Caja 3">Caja 3</option>
                    </select>
                </div>
            </div>

            <!-- **NUEVO:** Dashboard de M√©tricas -->
            <div class="dashboard-metrics">
                <!-- 1. Total Tarjeta -->
                <div class="metric-card metric-tarjeta">
                    <div class="metric-icon">üí≥</div>
                    <div class="metric-content">
                        <div class="metric-label">Total Tarjeta</div>
                        <div class="metric-value" id="metricTotalTarjeta">G$ 0</div>
                        <div class="metric-subtitle">Pagos con tarjeta</div>
                    </div>
                </div>

                <!-- 2. Pedidos Ya -->
                <div class="metric-card metric-pedidosya">
                    <div class="metric-icon">üõµ</div>
                    <div class="metric-content">
                        <div class="metric-label">Pedidos Ya</div>
                        <div class="metric-value" id="metricTotalPedidosYa">G$ 0</div>
                        <div class="metric-subtitle">Ventas por app</div>
                    </div>
                </div>

                <!-- 3. Ventas a Cr√©dito -->
                <div class="metric-card metric-credito">
                    <div class="metric-icon">üìù</div>
                    <div class="metric-content">
                        <div class="metric-label">Ventas a Credito</div>
                        <div class="metric-value" id="metricTotalCredito">G$ 0</div>
                        <div class="metric-subtitle">Ventas a cr√©dito</div>
                    </div>
                </div>

                <!-- 4. Total Efectivo -->
                <div class="metric-card metric-efectivo">
                    <div class="metric-icon">üíµ</div>
                    <div class="metric-content">
                        <div class="metric-label">Total Efectivo</div>
                        <div class="metric-value" id="metricTotalEfectivo">G$ 0</div>
                        <div class="metric-subtitle">Pagos en efectivo</div>
                    </div>
                </div>
            </div>

            <!-- Seccion Recaudacion -->
            <div class="recaudacion-section">
                <h2 class="section-title text-center">RECAUDACION</h2>
                <div class="table-responsive">
                    <table class="tabla-recaudacion" id="tablaRecaudacion">
                        <thead>
                            <tr>
                                <th>CAJERO</th>
                                <th>TOTAL TARJETA</th>
                                <th>PEDIDOS YA</th>
                                <th>VENTA A CREDITO</th>
                                <th>EFECTIVO</th>
                                <th>SOBRANTE</th>
                                <th>FALTANTE</th>
                                <th>SubTotales/user</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyRecaudacion">
                        </tbody>
                        <tfoot id="tfootRecaudacion">
                        </tfoot>
                    </table>
                </div>
            </div>

        </section>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <!-- **CORRECCI√ìN:** Cargar app.js PRIMERO, antes de llamar a las funciones -->
    <script src="../js/app.js"></script>
    <script src="../js/resumen-metrics.js"></script>
    <script>
        if (window.inicializarSupabase) { window.inicializarSupabase(); }
        if (window.initSupabaseData) { window.initSupabaseData(); }

        // Inicializar m√©tricas cuando se carga la p√°gina
        window.addEventListener('DOMContentLoaded', function () {
            if (typeof window.actualizarMetricasResumen === 'function') {
                // Esperar un momento para que los datos se carguen
                setTimeout(() => {
                    window.actualizarMetricasResumen();
                }, 500);
            }
        });
    </script>
</body>

</html>